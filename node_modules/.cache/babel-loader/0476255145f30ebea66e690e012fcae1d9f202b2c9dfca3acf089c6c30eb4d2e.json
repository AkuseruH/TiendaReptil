{"ast":null,"code":"var _jsxFileName = \"C:\\\\tienda_reptil\\\\src\\\\components\\\\CartContext.jsx\",\n  _s = $RefreshSig$(),\n  _s2 = $RefreshSig$();\nimport React, { createContext, useContext, useState, useEffect } from \"react\";\nimport { supabase } from \"../supabase/client\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst CartContext = /*#__PURE__*/createContext();\nexport const CartProvider = ({\n  children\n}) => {\n  _s();\n  const [cart, setCart] = useState([]);\n  const [user, setUser] = useState(null);\n  useEffect(() => {\n    supabase.auth.getUser().then(({\n      data\n    }) => setUser(data === null || data === void 0 ? void 0 : data.user));\n  }, []);\n  const addToCart = async product => {\n    if (!user) {\n      alert(\"Debes iniciar sesión para agregar productos al carrito\");\n      return;\n    }\n    let {\n      data: cartData\n    } = await supabase.from(\"carts\").select(\"*\").eq(\"user_id\", user.id).single();\n\n    // Crear carrito si no existe\n    if (!cartData) {\n      const {\n        data: newCart\n      } = await supabase.from(\"carts\").insert({\n        user_id: user.id\n      }).select().single();\n      cartData = newCart;\n    }\n\n    // Insertar item\n    await supabase.from(\"cart_items\").insert({\n      cart_id: cartData.id,\n      product_id: product.id,\n      quantity: 1\n    });\n    setCart([...cart, {\n      ...product,\n      quantity: 1\n    }]);\n  };\n  const removeFromCart = async productId => {\n    setCart(cart.filter(item => item.id !== productId));\n    if (user) {\n      const {\n        data: userCart\n      } = await supabase.from(\"carts\").select(\"id\").eq(\"user_id\", user.id).single();\n      if (userCart) {\n        await supabase.from(\"cart_items\").delete().eq(\"cart_id\", userCart.id).eq(\"product_id\", productId);\n      }\n    }\n  };\n  const clearCart = async () => {\n    setCart([]);\n    if (user) {\n      const {\n        data: userCart\n      } = await supabase.from(\"carts\").select(\"id\").eq(\"user_id\", user.id).single();\n      if (userCart) {\n        await supabase.from(\"cart_items\").delete().eq(\"cart_id\", userCart.id);\n      }\n    }\n  };\n  const checkout = async () => {\n    if (!user) return alert(\"Debes iniciar sesión para confirmar el pedido\");\n    const total = cart.reduce((sum, item) => sum + item.price * item.quantity, 0);\n    const {\n      data: order\n    } = await supabase.from(\"orders\").insert({\n      user_id: user.id,\n      total,\n      status: \"pendiente\"\n    }).select().single();\n    for (const item of cart) {\n      await supabase.from(\"order_items\").insert({\n        order_id: order.id,\n        product_id: item.id,\n        quantity: item.quantity,\n        price: item.price\n      });\n    }\n    await clearCart();\n    alert(\"✅ Pedido registrado correctamente.\");\n  };\n  return /*#__PURE__*/_jsxDEV(CartContext.Provider, {\n    value: {\n      cart,\n      addToCart,\n      removeFromCart,\n      clearCart,\n      checkout\n    },\n    children: children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 102,\n    columnNumber: 5\n  }, this);\n};\n_s(CartProvider, \"ncr6FOReRIc+0ZpQ8GquZB7U2dE=\");\n_c = CartProvider;\nexport const useCart = () => {\n  _s2();\n  return useContext(CartContext);\n};\n_s2(useCart, \"gDsCjeeItUuvgOWf1v4qoK9RF6k=\");\nvar _c;\n$RefreshReg$(_c, \"CartProvider\");","map":{"version":3,"names":["React","createContext","useContext","useState","useEffect","supabase","jsxDEV","_jsxDEV","CartContext","CartProvider","children","_s","cart","setCart","user","setUser","auth","getUser","then","data","addToCart","product","alert","cartData","from","select","eq","id","single","newCart","insert","user_id","cart_id","product_id","quantity","removeFromCart","productId","filter","item","userCart","delete","clearCart","checkout","total","reduce","sum","price","order","status","order_id","Provider","value","fileName","_jsxFileName","lineNumber","columnNumber","_c","useCart","_s2","$RefreshReg$"],"sources":["C:/tienda_reptil/src/components/CartContext.jsx"],"sourcesContent":["import React, { createContext, useContext, useState, useEffect } from \"react\";\r\nimport { supabase } from \"../supabase/client\";\r\n\r\nconst CartContext = createContext();\r\n\r\nexport const CartProvider = ({ children }) => {\r\n  const [cart, setCart] = useState([]);\r\n  const [user, setUser] = useState(null);\r\n\r\n  useEffect(() => {\r\n    supabase.auth.getUser().then(({ data }) => setUser(data?.user));\r\n  }, []);\r\n\r\n  const addToCart = async (product) => {\r\n    if (!user) {\r\n      alert(\"Debes iniciar sesión para agregar productos al carrito\");\r\n      return;\r\n    }\r\n\r\n    let { data: cartData } = await supabase\r\n      .from(\"carts\")\r\n      .select(\"*\")\r\n      .eq(\"user_id\", user.id)\r\n      .single();\r\n\r\n    // Crear carrito si no existe\r\n    if (!cartData) {\r\n      const { data: newCart } = await supabase\r\n        .from(\"carts\")\r\n        .insert({ user_id: user.id })\r\n        .select()\r\n        .single();\r\n      cartData = newCart;\r\n    }\r\n\r\n    // Insertar item\r\n    await supabase.from(\"cart_items\").insert({\r\n      cart_id: cartData.id,\r\n      product_id: product.id,\r\n      quantity: 1,\r\n    });\r\n\r\n    setCart([...cart, { ...product, quantity: 1 }]);\r\n  };\r\n\r\n  const removeFromCart = async (productId) => {\r\n    setCart(cart.filter((item) => item.id !== productId));\r\n    if (user) {\r\n      const { data: userCart } = await supabase\r\n        .from(\"carts\")\r\n        .select(\"id\")\r\n        .eq(\"user_id\", user.id)\r\n        .single();\r\n      if (userCart) {\r\n        await supabase\r\n          .from(\"cart_items\")\r\n          .delete()\r\n          .eq(\"cart_id\", userCart.id)\r\n          .eq(\"product_id\", productId);\r\n      }\r\n    }\r\n  };\r\n\r\n  const clearCart = async () => {\r\n    setCart([]);\r\n    if (user) {\r\n      const { data: userCart } = await supabase\r\n        .from(\"carts\")\r\n        .select(\"id\")\r\n        .eq(\"user_id\", user.id)\r\n        .single();\r\n      if (userCart) {\r\n        await supabase.from(\"cart_items\").delete().eq(\"cart_id\", userCart.id);\r\n      }\r\n    }\r\n  };\r\n\r\n  const checkout = async () => {\r\n    if (!user) return alert(\"Debes iniciar sesión para confirmar el pedido\");\r\n    const total = cart.reduce((sum, item) => sum + item.price * item.quantity, 0);\r\n\r\n    const { data: order } = await supabase\r\n      .from(\"orders\")\r\n      .insert({ user_id: user.id, total, status: \"pendiente\" })\r\n      .select()\r\n      .single();\r\n\r\n    for (const item of cart) {\r\n      await supabase.from(\"order_items\").insert({\r\n        order_id: order.id,\r\n        product_id: item.id,\r\n        quantity: item.quantity,\r\n        price: item.price,\r\n      });\r\n    }\r\n\r\n    await clearCart();\r\n    alert(\"✅ Pedido registrado correctamente.\");\r\n  };\r\n\r\n  return (\r\n    <CartContext.Provider\r\n      value={{ cart, addToCart, removeFromCart, clearCart, checkout }}\r\n    >\r\n      {children}\r\n    </CartContext.Provider>\r\n  );\r\n};\r\n\r\nexport const useCart = () => useContext(CartContext);\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}